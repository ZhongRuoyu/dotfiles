# shellcheck disable=SC2148

# shellcheck source=/dev/null
source "$HOME/.shell/interactive"

# oh-my-zsh
ZSH="$HOME/.oh-my-zsh"
if [[ -e "$ZSH" ]]; then
  export ZSH
  export ZSH_CUSTOM="$ZSH/custom"
  # shellcheck disable=SC2034
  plugins=(
    git
  )
  # Always auto-update oh-my-zsh.
  # shellcheck disable=SC2034
  DISABLE_UPDATE_PROMPT=true
else
  unset ZSH
  export ZSH_CUSTOM="$HOME/.local/share/zsh/custom"
fi

# zsh-autosuggestions
if [[ -d "$ZSH_CUSTOM/plugins/zsh-autosuggestions" ]]; then
  if [[ -n "$ZSH" ]]; then
    plugins+=("zsh-autosuggestions")
  else
    source "$ZSH_CUSTOM/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh"
  fi
fi

# zsh-syntax-highlighting
if [[ -d "$ZSH_CUSTOM/plugins/zsh-syntax-highlighting" ]]; then
  if [[ -n "$ZSH" ]]; then
    plugins+=("zsh-syntax-highlighting")
  else
    source "$ZSH_CUSTOM/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
  fi
fi

# zsh-completions
if [[ -d "$ZSH_CUSTOM/plugins/zsh-completions" ]]; then
  FPATH="$ZSH_CUSTOM/plugins/zsh-completions/src${FPATH:+:$FPATH}"
fi

# nodenv completions
if [[ -n "$NODENV_ROOT" ]]; then
  FPATH="$NODENV_ROOT/completions${FPATH:+:$FPATH}"
fi

# rbenv completions
if [[ -n "$RBENV_ROOT" ]]; then
  FPATH="$RBENV_ROOT/completions${FPATH:+:$FPATH}"
fi

# Prompt settings
PS1="[%n@%m %1~]%(!.#.$) "

# History control
setopt HIST_FCNTL_LOCK
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_REDUCE_BLANKS
setopt SHARE_HISTORY
# shellcheck disable=SC2034
SAVEHIST=65536
HISTSIZE=65536

# zshzle settings
bindkey "^[(" kill-word
bindkey "^W" backward-kill-word

# Local completions
FPATH="$HOME/.local/share/zsh/site-functions${FPATH:+:$FPATH}"

if [[ -n "$ZSH" ]]; then
  # shellcheck source=/dev/null
  source "$ZSH/oh-my-zsh.sh"
else
  autoload -Uz compinit
  autoload -Uz bashcompinit
  compinit
  bashcompinit
fi

# conda and mamba completions
if [[ -n "$CONDA_ROOT" ]] && [[ -e "$CONDA_ROOT/condabin/mamba" ]]; then
  complete -o default -F _umamba_zsh_completions conda
  complete -o default -F _umamba_zsh_completions mamba
fi

# Local interactive profile
if [[ -r "$HOME/.zsh/interactive.local" ]]; then
  # shellcheck source=/dev/null
  source "$HOME/.zsh/interactive.local"
fi
